<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root { --primary: #0D47A1; --secondary: #1976D2; --success: #2E7D32; --warning: #FBC02D; --danger: #D32F2F; --bg: #f4f7f6; }
    body { font-family: 'Kanit', sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; }
    .container { max-width: 500px; margin: 0 auto; background: white; border-radius: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); padding: 20px; box-sizing: border-box; min-height: 95vh; }
    
    /* Header & General */
    h1 { color: var(--primary); text-align: center; font-size: 24px; border-bottom: 4px solid var(--warning); padding-bottom: 10px; margin-bottom: 20px; }
    h2 { font-size: 18px; color: var(--secondary); margin-bottom: 15px; border-left: 5px solid var(--warning); padding-left: 10px; }
    .page { display: none; animation: fadeIn 0.4s ease; }
    .page.active { display: block !important; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Inputs */
    .input-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px; color: #555; }
    input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 12px; box-sizing: border-box; font-family: 'Kanit'; font-size: 15px; }
    input:focus { border-color: var(--secondary); outline: none; }

    /* Menu Grid */
    .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
    .btn-menu { border: none; border-radius: 20px; padding: 22px 10px; color: white; cursor: pointer; font-weight: 600; display: flex; flex-direction: column; align-items: center; gap: 8px; font-size: 14px; transition: 0.2s; }
    .btn-menu:active { transform: scale(0.95); }
    .btn-site { background: linear-gradient(135deg, #06b6d4, #0891b2); }
    .btn-in { background: linear-gradient(135deg, #22c55e, #16a34a); }
    .btn-out { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .btn-rep { background: linear-gradient(135deg, #a855f7, #9333ea); }
    .btn-exp { background: linear-gradient(135deg, #ec4899, #db2777); }
    .btn-cap { background: linear-gradient(135deg, #64748b, #475569); }

    /* Buttons */
    .main-btn { background: var(--primary); color: white; width: 100%; padding: 16px; border: none; border-radius: 15px; font-size: 18px; font-weight: 600; margin-top: 10px; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 10px; }
    .back-btn { background: #64748b; margin-top: 10px; }
    .card-site { background: #f8fafc; border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid #e2e8f0; }
    
    /* Image Preview */
    .preview-box { text-align: center; margin: 15px 0; display: none; }
    .preview-img { max-width: 100%; border-radius: 15px; border: 3px solid #ddd; }
  </style>
</head>
<body>

<div class="container">
  
  <div id="page-home" class="page active">
    <h1>2026 AEC Report</h1>
    <div class="input-group">
      <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô (Name) - Column C</label>
      <input type="text" id="main_name" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
    </div>
    <div class="input-group">
      <label>‡∏†‡∏≤‡∏Ñ‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î (Region) - Column D</label>
      <select id="main_region">
        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏Ñ --</option>
        <option>BKK</option><option>CR</option><option>ER</option><option>NER</option>
        <option>NR</option><option>SR</option><option>TE</option><option>DR</option><option>OFFICE</option>
      </select>
    </div>
    <div class="menu-grid">
      <button class="btn-menu btn-site" onclick="startFlow('Site Check In')"><i class="fas fa-map-pin fa-2x"></i>Site Check In</button>
      <button class="btn-menu btn-in" onclick="startFlow('Check In')"><i class="fas fa-sign-in-alt fa-2x"></i>Check In</button>
      <button class="btn-menu btn-out" onclick="startFlow('Check Out')"><i class="fas fa-sign-out-alt fa-2x"></i>Check Out</button>
      <button class="btn-menu btn-rep" onclick="startFlow('Report')"><i class="fas fa-file-contract fa-2x"></i>Report</button>
      <button class="btn-menu btn-exp" onclick="startFlow('Expenses')"><i class="fas fa-wallet fa-2x"></i>Expenses</button>
      <button class="btn-menu btn-cap" onclick="startFlow('Capture')"><i class="fas fa-camera fa-2x"></i>Capture</button>
    </div>
  </div>

  <div id="page-check" class="page">
    <h2 id="check-title"></h2>
    <div id="check-fields"></div>
    <div class="input-group">
      <label>üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ/‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ (Photo - Col I)</label>
      <input type="file" id="check-file" accept="image/*" capture="camera" onchange="handlePreview(this)">
    </div>
    <div id="check-preview" class="preview-box">
      <p id="check-gps-info" style="font-size:12px; color:blue; font-weight:bold;"></p>
      <img id="check-img" class="preview-img">
    </div>
    <button class="main-btn" onclick="submitCheck()">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• <i class="fas fa-paper-plane"></i></button>
    <button class="main-btn back-btn" onclick="goHome()">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
  </div>

  <div id="page-report-1" class="page">
    <h2>üìù ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (Report)</h2>
    <label>‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£ (Buddy - Col K)</label><input type="text" id="r_buddy" class="input-group">
    <label>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (Date - Col A)</label><input type="date" id="r_date" class="input-group">
    <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô (JOBTYPE - Col P)</label>
    <select id="r_type" onchange="toggleDiv('r_etc_div', this.value==='‡∏á‡∏≤‡∏ô ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ')" class="input-group">
      <option>‡∏á‡∏≤‡∏ô CR</option><option>‡∏á‡∏≤‡∏ô OFFICE</option><option>‡∏á‡∏≤‡∏ô TE</option><option>‡∏á‡∏≤‡∏ô DRONE</option><option>‡∏á‡∏≤‡∏ô ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
    </select>
    <div id="r_etc_div" style="display:none;"><label>‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏ô‡∏¥‡∏î‡∏á‡∏≤‡∏ô (ETC - Col Q)</label><input type="text" id="r_etc" class="input-group"></div>
    <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô (JobDetail - Col R)</label><textarea id="r_detail" rows="3" class="input-group"></textarea>
    <button class="main-btn" onclick="nextReportStep()">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ûî</button>
    <button class="main-btn back-btn" onclick="goHome()">‡∏Å‡∏•‡∏±‡∏ö</button>
  </div>

  <div id="page-report-cr" class="page">
    <h2>üè¢ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô CR</h2>
    <div id="cr-sites-area"></div>
  </div>

  <div id="page-expenses" class="page">
    <h2>üí∞ ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ (Expenses)</h2>
    <div id="exp-f1">
      <label>‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£ (Buddy - Col K)</label><input type="text" id="ex_buddy" class="input-group">
      <label>‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (Date - Col A)</label><input type="date" id="ex_date" class="input-group">
      <label>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ã‡∏ï‡πå (EPSite - Col AR)</label><input type="text" id="ex_site" class="input-group">
      <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (EPPv. - Col AS)</label><input type="text" id="ex_prov" class="input-group">
      <label>‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô (EPOil - Col AT)</label><input type="number" id="ex_oil" value="0" class="input-group">
      <label>‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å (EPHotel - Col AU)</label><input type="number" id="ex_hotel" value="0" class="input-group">
      <button class="main-btn" onclick="toggleExp(2)">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ (‡∏£‡∏∞‡∏ö‡∏∏‡∏Ñ‡πà‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©) ‚ûî</button>
    </div>
    <div id="exp-f2" style="display:none;">
      <label>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏û‡∏¥‡πÄ‡∏®‡∏© (EPSpc. - Col AX)</label>
      <select id="ex_spc_type" onchange="toggleDiv('ex_spc_div', this.value!=='‡πÑ‡∏°‡πà‡∏°‡∏µ')" class="input-group">
        <option>‡πÑ‡∏°‡πà‡∏°‡∏µ</option><option>‡πÄ‡∏ö‡∏¥‡∏Å‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô/‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡∏°/‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ</option><option>‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</option><option>‡∏ó‡∏≥‡∏ü‡∏±‡∏ô</option><option>‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</option>
      </select>
      <div id="ex_spc_div" style="display:none;"><label>‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (EPCSpc - Col AY)</label><input type="number" id="ex_spc_val" value="0" class="input-group"></div>
      
      <label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏ö‡∏¥‡∏• (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10 ‡∏£‡∏π‡∏õ)</label>
      <input type="file" id="ex_files" multiple accept="image/*" class="input-group">
      <button class="main-btn" onclick="submitExpenses()">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ ‚ûî</button>
    </div>
  </div>

  <div id="page-capture" class="page">
    <h2>üì∏ Capture Report</h2>
    <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 7 ‡∏ß‡∏±‡∏ô</label>
    <select id="cap_date" class="input-group"></select>
    <button class="main-btn" onclick="alert('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets...')">‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
    <button class="main-btn back-btn" onclick="goHome()">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
  </div>

  <div id="final-1" class="page" style="text-align:center;">
    <div style="font-size:60px; color:var(--success); margin:20px 0;"><i class="fas fa-shield-heart"></i></div>
    <h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>
    <div style="background:#fff3e0; border-radius:15px; padding:15px; color:#e65100; font-weight:bold; margin:20px 0;">
      üë∑‚Äç‚ôÇÔ∏è Safety First! <br> ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÅ‡∏•‡∏∞‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö
    </div>
    <button class="main-btn" onclick="goHome()">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</button>
  </div>

  <div id="final-2" class="page" style="text-align:center;">
    <div style="font-size:60px; color:var(--success); margin:20px 0;"><i class="fas fa-check-circle"></i></div>
    <h2>‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•!</h2>
    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö</p>
    <button class="main-btn" onclick="goHome()">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</button>
  </div>

</div>

<script>
  let curStatus = "", gpsStr = "", base64Img = "", siteIndex = 1;
  const gas_url = "https://script.google.com/macros/s/AKfycbyi7bfX6U_-iFVAu0C54itxe8nj1wdSQhDKfenDMtKvjo8JDLFSrxykcG-Go-Qzb1fe/exec";

  // --- Logic ‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ ---
  function startFlow(st) {
    const name = document.getElementById('main_name').value;
    const reg = document.getElementById('main_region').value;
    if(!name || !reg) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
    
    curStatus = st;
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    
    if(['Site Check In','Check In','Check Out'].includes(st)) {
      document.getElementById('check-title').innerText = st;
      renderCheckFields(st);
      document.getElementById('page-check').classList.add('active');
      getGPS();
    } else {
      document.getElementById('page-' + st.toLowerCase() + (st==='Report'?'-1':'')).classList.add('active');
      if(st==='Capture') setupCapDates();
    }
  }

  // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1-3 Logic ---
  function renderCheckFields(st) {
    let html = "";
    if(st !== 'Site Check In') {
      html = `
        <label>‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£ (Buddy)</label><input type="text" id="f_buddy" class="input-group">
        <label>‡πÉ‡∏ä‡πâ‡∏£‡∏ñ‡πÉ‡∏Ñ‡∏£ (Car)</label><input type="text" id="f_car" class="input-group">
        <label>‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå (Mileage)</label><input type="number" id="f_mile" class="input-group">
        <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà (PLACE)</label><input type="text" id="f_place" class="input-group">
        <label>${st==='Check In'?'PLAN':'BRIFE'}</label><textarea id="f_plan" rows="3" class="input-group"></textarea>
      `;
    }
    document.getElementById('check-fields').innerHTML = html;
  }

  function handlePreview(input) {
    const reader = new FileReader();
    reader.onload = e => {
      base64Img = e.target.result;
      document.getElementById('check-img').src = base64Img;
      document.getElementById('check-gps-info').innerText = "üìç GPS Captured: " + gpsStr;
      document.getElementById('check-preview').style.display = 'block';
    };
    reader.readAsDataURL(input.files[0]);
  }

  function submitCheck() {
    if(!base64Img) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á");
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏õ Gas ... (‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢)
    showFinal(curStatus);
  }

  // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4 Logic (‡∏á‡∏≤‡∏ô CR 1-4 ‡πÑ‡∏ã‡∏ï‡πå) ---
  function nextReportStep() {
    if(document.getElementById('r_type').value === '‡∏á‡∏≤‡∏ô CR') {
      document.getElementById('page-report-1').classList.remove('active');
      document.getElementById('page-report-cr').classList.add('active');
      renderCRSite(1);
    } else {
      showFinal('Report');
    }
  }

  function renderCRSite(n) {
    const area = document.getElementById('cr-sites-area');
    const html = `
      <div class="card-site">
        <h3>‡πÑ‡∏ã‡∏ï‡πå‡∏ó‡∏µ‡πà ${n}</h3>
        ${n==1?'<label>‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏†‡∏≤‡∏Ñ (JobRegion)</label><select id="s_reg" class="input-group"><option>BKK</option><option>CR</option><option>ER</option><option>NER</option><option>NR</option><option>SR</option></select>':''}
        <label>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ã‡∏ï‡πå (Site${n})</label><input type="text" id="sn_${n}" class="input-group">
        <label>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (Province${n})</label><input type="text" id="sp_${n}" class="input-group">
        <label>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏á‡∏≤‡∏ô (JobSite${n})</label>
        <select id="sj_${n}" class="input-group">
          <option>‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥ CR - CRL</option><option>‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡∏ó‡∏≥‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Ñ‡∏°</option><option>‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏≤‡∏ó‡∏µ‡πà SA</option><option>‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
        </select>
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ô‡∏≥ (LDSite${n})</label><input type="text" id="sl_${n}" class="input-group">
        <label>‡∏°‡∏µ‡πÑ‡∏ã‡∏ï‡πå‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</label>
        <select onchange="if(this.value==='‡∏°‡∏µ‡πÑ‡∏ã‡∏ï‡πå‡∏ó‡∏µ‡πà ${n+1}') renderCRSite(${n+1})" class="input-group">
          <option>‡πÑ‡∏°‡πà‡∏°‡∏µ/‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</option>
          ${n<4 ? `<option>‡∏°‡∏µ‡πÑ‡∏ã‡∏ï‡πå‡∏ó‡∏µ‡πà ${n+1}</option>` : ''}
        </select>
        <button class="main-btn" onclick="showFinal('Report')">‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      </div>`;
    area.innerHTML += html;
  }

  // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 5 Logic ---
  function toggleExp(step) {
    document.getElementById('exp-f1').style.display = step === 1 ? 'block' : 'none';
    document.getElementById('exp-f2').style.display = step === 2 ? 'block' : 'none';
  }

  function submitExpenses() {
    alert("‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏ö‡∏¥‡∏•‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô...");
    showFinal('Expenses');
  }

  // --- Helper Functions ---
  function showFinal(st) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    if(['Site Check In','Check In'].includes(st)) {
      document.getElementById('final-1').classList.add('active');
    } else {
      document.getElementById('final-2').classList.add('active');
    }
  }

  function getGPS() {
    navigator.geolocation.getCurrentPosition(p => {
      gpsStr = p.coords.latitude.toFixed(6) + "," + p.coords.longitude.toFixed(6);
    }, err => console.log("GPS denied"), {enableHighAccuracy:true});
  }

  function toggleDiv(id, show) { document.getElementById(id).style.display = show ? 'block' : 'none'; }
  function goHome() { location.reload(); }

  function setupCapDates() {
    const sel = document.getElementById('cap_date');
    sel.innerHTML = "";
    for(let i=0; i<8; i++){
      let d = new Date(); d.setDate(d.getDate() - i);
      let opt = document.createElement('option');
      opt.value = d.toLocaleDateString('th-TH');
      opt.innerText = d.toLocaleDateString('th-TH');
      sel.appendChild(opt);
    }
  }
</script>

</body>
</html>
