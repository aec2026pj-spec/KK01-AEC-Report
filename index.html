<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root { --primary: #0D47A1; --secondary: #1976D2; --success: #2E7D32; --warning: #FBC02D; --bg: #f8fafc; }
    body { font-family: 'Kanit', sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #334155; }
    .container { max-width: 500px; margin: 0 auto; background: white; border-radius: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); padding: 25px; box-sizing: border-box; }
    h1 { color: var(--primary); text-align: center; font-size: 24px; border-bottom: 4px solid var(--warning); padding-bottom: 10px; }
    
    .input-group { text-align: left; margin-bottom: 15px; }
    label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px; color: #64748b; }
    input, select, textarea { width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 14px; box-sizing: border-box; font-size: 16px; font-family: 'Kanit'; }
    
    .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
    .btn-menu { border: none; border-radius: 20px; padding: 25px 10px; color: white; cursor: pointer; font-weight: 600; display: flex; flex-direction: column; align-items: center; gap: 10px; }
    .btn-site { background: linear-gradient(135deg, #06b6d4, #0891b2); }
    .btn-in { background: linear-gradient(135deg, #22c55e, #16a34a); }
    .btn-out { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .btn-rep { background: linear-gradient(135deg, #a855f7, #9333ea); }
    .btn-exp { background: linear-gradient(135deg, #ec4899, #db2777); }
    .btn-cap { background: linear-gradient(135deg, #64748b, #475569); }

    .page { display: none; }
    .active { display: block; animation: slideIn 0.3s ease-out; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .main-btn { background: var(--primary); color: white; width: 100%; padding: 16px; border: none; border-radius: 16px; font-size: 18px; font-weight: 600; margin-top: 15px; cursor: pointer; }
    .preview-box { background: #f1f5f9; border-radius: 15px; padding: 15px; text-align: center; margin-top: 15px; border: 2px dashed #cbd5e1; }
    .card-site { background: #f1f5f9; border-radius: 15px; padding: 15px; margin-bottom: 20px; border-left: 5px solid var(--primary); }
  </style>
</head>
<body>

<div class="container">
  <div id="page-home" class="page active">
    <h1>2026 AEC Report</h1>
    <div class="input-group">
      <label><i class="fas fa-user-circle"></i> ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô (Name)</label>
      <input type="text" id="userName" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
    </div>
    <div class="input-group">
      <label><i class="fas fa-map-marked-alt"></i> ‡∏†‡∏≤‡∏Ñ‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î (Region)</label>
      <select id="userRegion">
        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏Ñ --</option>
        <option>BKK</option><option>CR</option><option>ER</option><option>NER</option>
        <option>NR</option><option>SR</option><option>TE</option><option>DR</option><option>OFFICE</option>
      </select>
    </div>
    <div class="menu-grid">
      <button class="btn-menu btn-site" onclick="openForm('Site Check In')"><i class="fas fa-map-pin fa-2x"></i>Site Check In</button>
      <button class="btn-menu btn-in" onclick="openForm('Check In')"><i class="fas fa-sign-in-alt fa-2x"></i>Check In</button>
      <button class="btn-menu btn-out" onclick="openForm('Check Out')"><i class="fas fa-sign-out-alt fa-2x"></i>Check Out</button>
      <button class="btn-menu btn-rep" onclick="openForm('Report')"><i class="fas fa-paste fa-2x"></i>Report</button>
      <button class="btn-menu btn-exp" onclick="openForm('Expenses')"><i class="fas fa-coins fa-2x"></i>Expenses</button>
      <button class="btn-menu btn-cap" onclick="openForm('Capture')"><i class="fas fa-images fa-2x"></i>Capture</button>
    </div>
  </div>

  <div id="page-st" class="page">
    <h2 id="st-title"></h2>
    <div id="st-fields"></div>
    <div class="input-group">
      <label>üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û/‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</label>
      <input type="file" id="st-file" accept="image/*" capture="camera" onchange="doPreview(this)">
    </div>
    <div id="st-preview" class="preview-box" style="display:none;">
      <p id="st-gps-info" style="font-size:12px; color:blue;"></p>
      <img id="st-img" style="max-width:100%; border-radius:10px;">
    </div>
    <button class="main-btn" onclick="submitSt()">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• <i class="fas fa-paper-plane"></i></button>
    <button class="main-btn" style="background:#64748b" onclick="location.reload()">‡∏Å‡∏•‡∏±‡∏ö</button>
  </div>

  <div id="page-report" class="page">
    <h2>üìù ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (Report)</h2>
    <label>‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£</label><input type="text" id="r_buddy">
    <label>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" id="r_date">
    <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</label>
    <select id="r_type"><option>‡∏á‡∏≤‡∏ô CR</option><option>‡∏á‡∏≤‡∏ô OFFICE</option><option>‡∏á‡∏≤‡∏ô TE</option><option>‡∏á‡∏≤‡∏ô DRONE</option><option>‡∏á‡∏≤‡∏ô ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option></select>
    <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô</label><textarea id="r_detail"></textarea>
    <button class="main-btn" onclick="submitSt()">‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
    <button class="main-btn" style="background:#64748b" onclick="location.reload()">‡∏Å‡∏•‡∏±‡∏ö</button>
  </div>

  <div id="page-expenses" class="page">
    <h2>üí∞ ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ (Expenses)</h2>
    <label>Buddy</label><input type="text" id="ex_buddy">
    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å</label><input type="date" id="ex_date">
    <label>‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ã‡∏ï‡πå</label><input type="text" id="ex_site">
    <label>‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</label><input type="number" id="ex_oil" value="0">
    <label>‡∏£‡∏π‡∏õ‡∏ö‡∏¥‡∏• (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 10 ‡∏£‡∏π‡∏õ)</label>
    <input type="file" multiple accept="image/*">
    <button class="main-btn" onclick="submitSt()">‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</button>
    <button class="main-btn" style="background:#64748b" onclick="location.reload()">‡∏Å‡∏•‡∏±‡∏ö</button>
  </div>

  <div id="page-capture" class="page">
    <h2>üì∏ Capture Report</h2>
    <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
    <select id="cap_date"></select>
    <button class="main-btn" onclick="alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...')">‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    <button class="main-btn" style="background:#64748b" onclick="location.reload()">‡∏Å‡∏•‡∏±‡∏ö</button>
  </div>

</div>

<script>
  let curStatus = "", base64Img = "", gpsStr = "";

  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
  window.onload = () => {
    document.getElementById('userName').value = localStorage.getItem('aec_name') || "";
    document.getElementById('userRegion').value = localStorage.getItem('aec_reg') || "";
    
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ 6
    const sel = document.getElementById('cap_date');
    for(let i=0; i<8; i++){
      let d = new Date(); d.setDate(d.getDate() - i);
      let opt = document.createElement('option');
      opt.value = d.toLocaleDateString('th-TH');
      opt.innerText = d.toLocaleDateString('th-TH');
      sel.appendChild(opt);
    }
  };

  function openForm(status) {
    const name = document.getElementById('userName').value;
    const reg = document.getElementById('userRegion').value;
    if(!name || !reg) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏Ñ"); return; }
    
    localStorage.setItem('aec_name', name);
    localStorage.setItem('aec_reg', reg);
    curStatus = status;

    // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));

    if(['Site Check In','Check In','Check Out'].includes(status)) {
      document.getElementById('st-title').innerText = status;
      let html = "";
      if(status !== 'Site Check In') {
        html = `<label>‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£</label><input type="text" id="f_buddy">
                <label>‡πÉ‡∏ä‡πâ‡∏£‡∏ñ‡πÉ‡∏Ñ‡∏£</label><input type="text" id="f_car">
                <label>‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå</label><input type="number" id="f_mile">
                <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà ${status}</label><input type="text" id="f_place">
                <label>${status==='Check In'?'PLAN':'BRIFE'}</label><textarea id="f_plan"></textarea>`;
      }
      document.getElementById('st-fields').innerHTML = html;
      document.getElementById('page-st').classList.add('active');
      getGPS();
    } 
    else if(status === 'Report') document.getElementById('page-report').classList.add('active');
    else if(status === 'Expenses') document.getElementById('page-expenses').classList.add('active');
    else if(status === 'Capture') document.getElementById('page-capture').classList.add('active');
  }

  function getGPS() {
    navigator.geolocation.getCurrentPosition(p => {
      gpsStr = p.coords.latitude.toFixed(6) + "," + p.coords.longitude.toFixed(6);
    }, err => console.log("GPS Error"), {enableHighAccuracy:true});
  }

  function doPreview(input) {
    const reader = new FileReader();
    reader.onload = e => {
      base64Img = e.target.result;
      document.getElementById('st-img').src = base64Img;
      document.getElementById('st-gps-info').innerText = "üìç " + gpsStr;
      document.getElementById('st-preview').style.display = 'block';
    };
    reader.readAsDataURL(input.files[0]);
  }

  function submitSt() {
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Code.gs
    alert("‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏à‡∏≥‡∏•‡∏≠‡∏á)");
    location.reload();
  }
</script>
</body>
</html>
