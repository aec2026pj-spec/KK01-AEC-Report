<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root { --primary: #0D47A1; --secondary: #1976D2; --success: #2E7D32; --bg: #f4f7f6; }
    body { font-family: 'Kanit', sans-serif; background: var(--bg); margin: 0; padding: 15px; color: #333; }
    .container { max-width: 500px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); padding: 25px; }
    h1 { color: var(--primary); text-align: center; font-size: 24px; margin-bottom: 25px; border-bottom: 2px solid var(--primary); padding-bottom: 10px; }
    
    .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
    .btn-menu { border: none; border-radius: 15px; padding: 20px 10px; color: white; cursor: pointer; transition: 0.3s; font-weight: bold; text-align: center; font-size: 14px; }
    .btn-site { background: #00BCD4; } .btn-in { background: #4CAF50; } .btn-out { background: #FF9800; }
    .btn-rep { background: #9C27B0; } .btn-exp { background: #E91E63; } .btn-cap { background: #607D8B; }
    
    label { display: block; margin: 15px 0 5px; font-weight: bold; color: #555; }
    input, select, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 16px; margin-bottom: 10px; }
    .main-btn { background: var(--primary); color: white; width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 18px; font-weight: bold; margin-top: 20px; cursor: pointer; }
    
    .preview-box { background: #f0f0f0; border-radius: 10px; padding: 10px; text-align: center; margin-top: 10px; display: none; }
    #preview-img { max-width: 100%; border-radius: 8px; margin-top: 5px; }
    
    .page { display: none; animation: fadeIn 0.4s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .active { display: block; }

    .summary-card { background: #E3F2FD; border-left: 5px solid var(--primary); padding: 15px; border-radius: 8px; margin: 10px 0; font-size: 14px; }
  </style>
</head>
<body>

<div class="container">
  <div id="page-home" class="page active">
    <h1><i class="fas fa-chart-line"></i> 2026 AEC Report</h1>
    <label>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
    <input type="text" id="userName" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô">
    
    <label>‡∏†‡∏≤‡∏Ñ‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î</label>
    <select id="userRegion">
      <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏Ñ --</option>
      <option>BKK</option><option>CR</option><option>ER</option><option>NER</option>
      <option>NR</option><option>SR</option><option>TE</option><option>DR</option><option>OFFICE</option>
    </select>

    <div class="menu-grid">
      <button class="btn-menu btn-site" onclick="goPage('Site Check In')"><i class="fas fa-map-marker-alt"></i><br>Site Check In</button>
      <button class="btn-menu btn-in" onclick="goPage('Check In')"><i class="fas fa-sign-in-alt"></i><br>Check In</button>
      <button class="btn-menu btn-out" onclick="goPage('Check Out')"><i class="fas fa-sign-out-alt"></i><br>Check Out</button>
      <button class="btn-menu btn-rep" onclick="goPage('Report')"><i class="fas fa-file-alt"></i><br>Report</button>
      <button class="btn-menu btn-exp" onclick="goPage('Expenses')"><i class="fas fa-wallet"></i><br>Expenses</button>
      <button class="btn-menu btn-cap" onclick="goPage('Capture')"><i class="fas fa-camera"></i><br>Capture</button>
    </div>
  </div>

  <div id="page-form" class="page">
    <h2 id="form-title"></h2>
    <div id="form-fields"></div>
    
    <div class="section-photo">
      <label>‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û/‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</label>
      <input type="file" id="photo-file" accept="image/*" capture="camera" onchange="previewImage(this)">
      <div id="gps-status" style="font-size: 12px; color: blue;"></div>
      <div id="preview-area" class="preview-box">
        <p id="preview-gps"></p>
        <img id="preview-img" src="">
      </div>
    </div>
    
    <button class="main-btn" onclick="submitData()">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• <i class="fas fa-paper-plane"></i></button>
  </div>

  <div id="page-complex" class="page">
    <div id="complex-fields"></div>
    <button class="main-btn" id="next-btn" onclick="complexNext()">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ûî</button>
  </div>

  <div id="page-capture" class="page">
    <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</label>
    <select id="cap-date-select"></select>
    <div id="report-view" style="margin-top:20px;"></div>
    <button class="main-btn" onclick="window.print()"><i class="fas fa-download"></i> Capture/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    <button class="main-btn" style="background:#666" onclick="location.reload()">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
  </div>

  <div id="page-final" class="page text-center" style="text-align:center">
    <div id="final-icon" style="font-size: 80px; color: var(--success); margin: 20px 0;"></div>
    <h2 id="final-text"></h2>
    <p id="final-sub"></p>
    <button class="main-btn" onclick="location.reload()">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
  </div>

</div>

<script>
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyi7bfX6U_-iFVAu0C54itxe8nj1wdSQhDKfenDMtKvjo8JDLFSrxykcG-Go-Qzb1fe/exec";
  let currentStatus = "";
  let gpsData = { lat: "", lng: "", stamp: "" };
  let base64Image = "";
  let reportStep = 1;
  let expenseData = {};

  function goPage(status) {
    const name = document.getElementById('userName').value;
    const region = document.getElementById('userRegion').value;
    if(!name || !region) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô");
    
    currentStatus = status;
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    
    if(['Site Check In','Check In','Check Out'].includes(status)) {
      renderStandardForm(status);
      document.getElementById('page-form').classList.add('active');
      getGPS();
    } else if(status === 'Report' || status === 'Expenses') {
      startComplexFlow(status);
      document.getElementById('page-complex').classList.add('active');
    } else if(status === 'Capture') {
      renderCapturePage();
      document.getElementById('page-capture').classList.add('active');
    }
  }

  function renderStandardForm(st) {
    document.getElementById('form-title').innerText = st;
    let html = "";
    if(st !== 'Site Check In') {
      html += `<label>‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£</label><input type="text" id="f_buddy">
               <label>‡πÉ‡∏ä‡πâ‡∏£‡∏ñ‡πÉ‡∏Ñ‡∏£</label><input type="text" id="f_car">
               <label>‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå</label><input type="number" id="f_mile">
               <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà ${st}</label><input type="text" id="f_place">
               <label>${st === 'Check In' ? 'PLAN' : 'BRIFE'}</label><textarea id="f_plan"></textarea>`;
    }
    document.getElementById('form-fields').innerHTML = html;
  }

  function getGPS() {
    document.getElementById('gps-status').innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î...";
    navigator.geolocation.getCurrentPosition(p => {
      gpsData.lat = p.coords.latitude;
      gpsData.lng = p.coords.longitude;
      gpsData.stamp = gpsData.lat + "," + gpsData.lng;
      document.getElementById('gps-status').innerText = "‡∏û‡∏¥‡∏Å‡∏±‡∏î: " + gpsData.stamp;
    }, err => alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î GPS"));
  }

  function previewImage(input) {
    const reader = new FileReader();
    reader.onload = e => {
      base64Image = e.target.result;
      document.getElementById('preview-img').src = base64Image;
      document.getElementById('preview-gps').innerText = "üìç " + gpsData.stamp;
      document.getElementById('preview-area').style.display = 'block';
    };
    reader.readAsDataURL(input.files[0]);
  }

  function submitData() {
    const values = new Array(60).fill("");
    const now = new Date();
    values[0] = now.toLocaleDateString('th-TH');
    values[1] = now.toLocaleTimeString('th-TH', {hour:'2-digit', minute:'2-digit'});
    values[2] = document.getElementById('userName').value;
    values[3] = document.getElementById('userRegion').value;
    values[4] = currentStatus;
    values[5] = gpsData.stamp;
    values[6] = gpsData.stamp;
    // ... ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ï‡∏≤‡∏° Column ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
    
    // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    fetch(WEB_APP_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({
      values: values,
      region: values[3],
      status: currentStatus,
      image: base64Image,
      lat: gpsData.lat, lng: gpsData.lng
    })}).then(() => showFinal());
  }

  function showFinal() {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('page-final').classList.add('active');
    
    if(['Site Check In', 'Check In'].includes(currentStatus)) {
      document.getElementById('final-icon').innerHTML = '<i class="fas fa-heartbeat"></i>';
      document.getElementById('final-text').innerText = "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö";
      document.getElementById('final-sub').innerText = "Safety First! ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢";
    } else {
      document.getElementById('final-icon').innerHTML = '<i class="fas fa-thumbs-up"></i>';
      document.getElementById('final-text').innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢";
      document.getElementById('final-sub').innerText = "‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö";
    }
  }

  // ‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ (Report/Expense/Capture) ‡∏à‡∏∞‡πÉ‡∏ä‡πâ Logic ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡∏∞ Array Mapping ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏ß‡πâ‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö
</script>

</body>
</html>
